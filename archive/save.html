<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset=utf-8>
  <title>save-load</title>
</head>
<body>
	<div id="content"></div>
	<script>
		var node = document.createTextNode("hello");
		document.getElementById("content").appendChild(node);

		// https://stackoverflow.com/a/35251739
		function download_file(name, contents, mime) {
			mime = mime || "text/plain";
			let blob = new Blob([contents], {type: mime});
			let link = document.createElement("a");
			document.body.appendChild(link);
			link.download = name;
			link.href = window.URL.createObjectURL(blob);
			link.onclick = function(e) {
				let scope = this;
				setTimeout(function() {
					window.URL.revokeObjectURL(scope.href);
				}, 1500);
			};
			console.log(name, contents, mime, link);
			link.click();
			link.remove();
		}

		setTimeout(function() {
			let html = document.getElementsByTagName("html")[0].outerHTML;
			download_file("foo.html", html);
		}, 1000);
		function dynamic_text() {
			return "hello there";
		}

	</script>
	<button onclick='download_file("my_file.txt", dynamic_text())'>Download</button>
</body>
</html>
